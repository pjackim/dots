#!/usr/bin/python3

import os
import argparse
from multipledispatch import dispatch

class Arguments:
    pass

class Input:
    def __init__(self):
        self.args = Arguments()
        self.defineArgs()
        
    def defineArgs(self):
        parser = argparse.ArgumentParser(description='Worm propagation on various networks.')
        parser.add_argument('dir', type=str, help='The directory to expand', default='./')
        parser.add_argument('count', type=int, help='The number of instances to create', default=3)
        parser.add_argument('-l', '--layout', type=str, help='The BSPWM layout to apply', default='grid')

        args = parser.parse_args(namespace=self.args)
        
    def getArgs(self):
        return self.args

@dispatch(str, str, int)
def OpenProcess(name, args, count):
    for i in range(count):
        os.system("( " + str(name) + " " + args + " & )")

@dispatch(str, int)
def OpenProcess(name, count):
    OpenProcess(name, "", count)
        
def OpenTerminal(count):
    if (input.args.dir == './'):
        OpenProcess("konsole", "--separate --workdir " + input.args.dir, count)
    else:
        OpenProcess("konsole", "--separate --workdir ./" + input.args.dir, count)
    
input = Input()
os.system("bsp-layout set " + str(input.args.layout))
OpenTerminal(input.args.count)
os.system("clear && commandline -f repaint")